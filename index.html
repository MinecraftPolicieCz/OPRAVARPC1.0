<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Opravář PC</title>
    <style>
        /* Retro vzhled a layout zachován */
        body, html {
            margin: 0; padding: 0; overflow: hidden; height: 100vh;
            background-color: #0000AA; color: #FFFFFF;
            font-family: 'Courier New', Courier, monospace;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            line-height: 1.5; text-shadow: 0 0 5px rgba(255,255,255,0.5);
        }
        .retro-btn {
            border: 2px solid #FFFF00; background: #001B70; color: #FFFF00;
            border-radius: 6px; font-size: 1.07em; font-weight: bold; cursor: pointer;
            padding: 9px 40px; margin: 7px 0; transition: background 0.16s, color 0.13s;
        }
        .retro-btn:active, .retro-btn.selected { background: #FFFF00; color: #002288; }
        #main-menu, #tasks-section, #workbench-section, #shop-section, #sell-section {
            display: none; flex-direction: column; align-items: center;
            min-width: 340px; max-width: 96vw;
        }
        #main-menu { display: flex; }
        #main-menu h1 { margin-bottom: 1em; font-size: 2.1em; font-weight: bold; letter-spacing:1.3px; }
        #main-menu label { color: #FFD700; margin:6px 0 3px 0; display:inline-block;}
        select.retro-select {
            font-family: inherit; font-size: 1em; border-radius: 4px; border: 2px solid #FFD700; background: #001B70; color: #FFFF00; padding: 3px 12px;
        }
        /* Task list */
        .task-list { width: 100%; max-width: 480px; margin: 0 auto; }
        .task-item {
            background: #001850; border: 2px solid #FFFF00; border-radius: 10px;
            color: #FFD700; margin: 15px 0 7px 0; padding: 13px 17px 10px 17px;
            box-shadow: 0 0 10px #0008;
            display: flex; flex-direction: column;
        }
        .task-item .task-title { font-weight: bold; font-size: 1.1em; margin-bottom: 4px; }
        .task-item .task-desc { color: #FFFFCC; margin-bottom: 8px; }
        .task-item .task-btn { align-self: flex-end; }
        .task-item.accepted { background: #008800; color: #fff; border-color: #00ff90;}
        /* Pracovní stůl */
        #workbench-pc {
            background: #001850; border: 3px solid #FFFF00; border-radius: 12px;
            width: 390px; height: 180px; margin-top: 32px;
            box-shadow: 0 0 23px #000a; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: #FFD700; font-size: 1.13em; position: relative;
        }
        #workbench-section .retro-btn { margin-top:22px; }
        /* Retro konzole modal */
        #console-modal {
            display: none; position: fixed; left: 0; right: 0; top: 0; bottom: 0;
            background: rgba(0,0,0,0.25); z-index: 4000; align-items: center; justify-content: center;
        }
        #console-window {
            background: #111; border: 3px solid #fff; border-radius: 13px;
            width: 600px; max-width: 96vw; min-height: 260px;
            box-shadow: 0 0 50px #000a; color: #00FF00; font-family: 'Courier New', monospace;
            display: flex; flex-direction: column;
        }
        #console-header {
            background: #222; color: #fff; padding: 7px 14px;
            border-radius: 10px 10px 0 0; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center; user-select: none;
        }
        #console-close { font-size: 1.5em; cursor: pointer; color: #fff; background: #a00; border-radius: 5px; padding: 0 10px; margin-left: 15px; transition: background 0.14s; }
        #console-close:hover { background: #e22; }
        #console-body { background: #111; color: #00FF00; flex: 1; padding: 16px 12px 10px 18px; font-size: 1.15em; border-radius: 0 0 10px 10px;}
        #console { white-space: pre-wrap; min-height: 56px; font-size: 1.03em; }
        #input-line { display: flex; align-items: center; margin-top: 12px; }
        #prompt { padding-right: 7px; color: #FFFF00; font-weight: bold; }
        #input-field { background: none; border: none; color: #00FF00; font-family: inherit; font-size: 16px; outline: none; caret-color: #FFFF00; flex-grow: 1;}
        /* Hlasitost */
        #volume-control {
            position: fixed; left: 22px; bottom: 30px; z-index: 5000; display: flex; align-items: center; gap: 8px;
            background: #222; border: 2px solid #fff; border-radius: 8px; padding: 4px 16px 4px 10px; box-shadow: 0 1px 4px #0094ff77; font-size: 1.15em;
        }
        #volume-slider { width: 96px; accent-color: #FFFF00; }
        .volume-icon { width: 24px; height: 24px; fill: #FFFF00; filter: drop-shadow(0 0 3px #ff0a);}
        /* Info panely v rozích */
        #language-info, #creator-info {
            position: absolute; color: #888; font-size: 12px; text-align: right; right: 10px;
        }
        #language-info { bottom: 30px; }
        #creator-info { bottom: 10px; }
        @media (max-width:700px) { #console-window {width: 97vw;} }
    </style>
</head>
<body>
    <!-- Hlavní menu -->
    <div id="main-menu">
        <h1>OPRAVÁŘ PC 1.0</h1>
        <button class="retro-btn" onclick="startNewGame()">Nová hra</button>
        <button class="retro-btn" onclick="continueGame()">Pokračovat</button>
        <label>Jazyk:
            <select id="language-select" class="retro-select">
                <option value="cs">Čeština</option>
                <option value="en">English</option>
                <option value="de">Deutsch</option>
            </select>
        </label>
        <label>Obtížnost:
            <select id="difficulty-select" class="retro-select">
                <option value="easy">Lehká</option>
                <option value="normal">Normální</option>
                <option value="hard">Těžká</option>
            </select>
        </label>
        <button class="retro-btn" onclick="openShop()">Obchod</button>
        <button class="retro-btn" onclick="openSell()">Prodej</button>
    </div>
    <!-- Obchod -->
    <div id="shop-section">
        <h2>Obchod</h2>
        <span style="color:#FFD700;">(připravuje se)</span>
        <button class="retro-btn" onclick="showMainMenu()">Zpět do menu</button>
    </div>
    <!-- Prodej -->
    <div id="sell-section">
        <h2>Prodej</h2>
        <span style="color:#FFD700;">(připravuje se)</span>
        <button class="retro-btn" onclick="showMainMenu()">Zpět do menu</button>
    </div>
    <!-- Pracovní stůl -->
    <div id="workbench-section">
        <div id="workbench-pc">
            <span style="font-size:1.2em;">Zde se budou opravovat počítače.</span>
            <span style="display:block;font-size:0.92em;color:#FFD70099;margin-top:10px;">Použij tlačítko Úkoly pro práci!</span>
        </div>
        <button class="retro-btn" onclick="openTasks()">Úkoly</button>
        <button class="retro-btn" onclick="showMainMenu()">Menu</button>
    </div>
    <!-- Seznam úkolů -->
    <div id="tasks-section">
        <h2>Úkoly</h2>
        <div class="task-list" id="tasks-list"></div>
        <button class="retro-btn" onclick="showWorkbench()">Zpět na stůl</button>
    </div>
    <!-- Retro konzole modal -->
    <div id="console-modal">
      <div id="console-window">
        <div id="console-header">
          <span>Konzole (CMD)</span>
          <span id="console-close" onclick="closeConsole()">&times;</span>
        </div>
        <div id="console-body">
          <div id="console"></div>
          <div id="input-line">
            <span id="prompt">C:\></span>
            <input type="text" id="input-field" autocomplete="off" spellcheck="false">
          </div>
        </div>
      </div>
    </div>
    <!-- Retro hlasitost vlevo dole -->
    <div id="volume-control">
        <svg class="volume-icon" viewBox="0 0 24 24"><path d="M3 10v4h4l5 5V5L7 10H3zm13.5 2c0-1.77-1.02-3.29-2.5-4.03v2.06c.58.35 1 .98 1 1.74s-.42 1.39-1 1.74v2.06c1.48-.74 2.5-2.26 2.5-4.03z"></path></svg>
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1" />
    </div>
    <div id="language-info">
        <span id="lang-label">Jazyk</span>: <span id="current-lang">cs</span><br>
        <span id="change-lang-label">Změnit jazyk: menu</span>
    </div>
    <div id="creator-info">
        Vytvořil MinecraftPolicieCz
    </div>
    <script>
    // ================= ZÁKLADNÍ STAV HRY ==============
    let gameState = {
      money: 1000,
      lang: "cs",
      difficulty: "normal",
      tasks: [],
      acceptedTask: null // id úkolu co je přijmutý a opravuješ!
    };

    // ====== GENERUJ ÚKOLY (hlavní/vedlejší, přijímání) =====
    const TASK_LIBRARY = [
      { id: "VIRUS",    title: "Odstranit virus",      desc: "Systém je infikován virem! Spusť příkaz SCAN_VIRUS.",    command: "SCAN_VIRUS",    type:"main" },
      { id: "RAM",      title: "Diagnostika RAM",      desc: "Počítač hlásí chybu paměti. Použij příkaz TEST_RAM.",    command: "TEST_RAM",      type:"main" },
      { id: "CPU",      title: "Výměna procesoru",     desc: "CPU je vadný, použij příkaz REPLACE_CPU.",               command: "REPLACE_CPU",   type:"main" },
      { id: "RECOVER",  title: "Obnovit smazaná data", desc: "Obnov smazané soubory pomocí příkazu RECOVER_FILES.",    command: "RECOVER_FILES", type:"side" },
      { id: "CLEAN",    title: "Vyčistit disk",        desc: "Proveď úklid pomocí příkazu CLEAN_DISK.",                command: "CLEAN_DISK",    type:"side" },
      { id: "OPTIMIZE", title: "Zrychlit systém",      desc: "Použij příkaz OPTIMIZE k optimalizaci.",                 command: "OPTIMIZE",      type:"side" }
    ];

    // =============== OBRÁCENÍ SEKCI ===================
    function showMainMenu() {
      hideAllSections();
      document.getElementById('main-menu').style.display = 'flex';
    }
    function showWorkbench() {
      hideAllSections();
      document.getElementById('workbench-section').style.display = 'flex';
    }
    function openTasks() {
      hideAllSections();
      document.getElementById('tasks-section').style.display = 'flex';
      renderTasks();
    }
    function openShop() {
      hideAllSections();
      document.getElementById('shop-section').style.display = 'flex';
    }
    function openSell() {
      hideAllSections();
      document.getElementById('sell-section').style.display = 'flex';
    }
    function hideAllSections() {
      ['main-menu','workbench-section','tasks-section','shop-section','sell-section'].forEach(id=>document.getElementById(id).style.display='none');
    }

    // =============== MENU TLAČÍTKA ====================
    document.getElementById('language-select').addEventListener('change', function(){
      gameState.lang = this.value;
      document.getElementById('current-lang').textContent = this.value;
      saveGame();
    });
    document.getElementById('difficulty-select').addEventListener('change', function(){
      gameState.difficulty = this.value;
      saveGame();
    });

    // =============== NOVÁ HRA & POKRAČOVAT ===========
    function startNewGame() {
      gameState = {
        money: 1000,
        lang: document.getElementById('language-select').value,
        difficulty: document.getElementById('difficulty-select').value,
        tasks: [],
        acceptedTask: null
      };
      addInitialTasks();
      saveGame();
      showWorkbench();
    }
    function continueGame() {
      if(loadGame()) {
        showWorkbench();
      } else {
        alert("Žádná uložená hra nenalezena!");
      }
    }

    // =============== UKLÁDÁNÍ/NAČÍTÁNÍ ===============
    function saveGame() {
      localStorage.setItem('opravar-save', JSON.stringify(gameState));
    }
    function loadGame() {
      const s = localStorage.getItem('opravar-save');
      if(!s) return false;
      try {
        const loaded = JSON.parse(s);
        Object.assign(gameState, loaded);
        return true;
      } catch { return false; }
    }

    // =============== ÚKOLY - GENERACE, PŘIJETÍ =========
    function addInitialTasks() {
      gameState.tasks = [];
      // Na start max 2 hlavní + 2 vedlejší náhodné
      let main = TASK_LIBRARY.filter(t=>t.type==="main");
      let side = TASK_LIBRARY.filter(t=>t.type==="side");
      shuffle(main); shuffle(side);
      gameState.tasks.push(...main.slice(0,2), ...side.slice(0,2));
    }
    function renderTasks() {
      const list = document.getElementById('tasks-list');
      list.innerHTML = "";
      if(gameState.tasks.length===0) {
        list.innerHTML = "<span style='color:#FFD70099'>Žádné úkoly</span>";
        return;
      }
      gameState.tasks.forEach((task,i)=>{
        const accepted = gameState.acceptedTask===task.id;
        const el = document.createElement('div');
        el.className = "task-item" + (accepted ? " accepted":"");
        el.innerHTML = `<div class="task-title">${task.title}</div>
          <div class="task-desc">${task.desc}</div>`;
        if(!accepted) {
          const btn = document.createElement('button');
          btn.className = "retro-btn task-btn";
          btn.textContent = "Přijmout";
          btn.onclick = ()=>acceptTask(task.id);
          el.appendChild(btn);
        } else {
          const btn = document.createElement('button');
          btn.className = "retro-btn task-btn";
          btn.textContent = "Opravovat";
          btn.onclick = ()=>openConsoleForTask(task);
          el.appendChild(btn);
        }
        list.appendChild(el);
      });
    }
    function acceptTask(id) {
      gameState.acceptedTask = id;
      saveGame();
      showWorkbench();
    }

    // =============== KONZOLE ==========================
    let currentConsoleTask = null;
    function openConsoleForTask(task) {
      currentConsoleTask = task;
      document.getElementById('console').innerHTML = `<span style="color:#FFD700">${task.desc.replace(/<[^>]+>/g,"")}</span>\n`;
      document.getElementById('input-field').value = "";
      document.getElementById('console-modal').style.display = 'flex';
      setTimeout(()=>{document.getElementById('input-field').focus();},80);
    }
    function closeConsole() {
      document.getElementById('console-modal').style.display = 'none';
      currentConsoleTask = null;
    }
    document.getElementById('input-field').addEventListener('keydown', function(e){
      if(e.key==="Enter" && currentConsoleTask) {
        const val = this.value.trim();
        if(!val) return;
        let buf = document.getElementById('console').textContent;
        buf += "\nC:\\> "+val;
        if(val.toUpperCase() === currentConsoleTask.command) {
          buf += "\nOK: Úkol splněn!";
          // smažeme úkol z task listu a zrušíme accepted
          gameState.tasks = gameState.tasks.filter(t=>t.id!==currentConsoleTask.id);
          gameState.acceptedTask = null;
          saveGame();
          setTimeout(()=>{
            closeConsole();
            showWorkbench();
          }, 700);
        } else {
          buf += "\nChybný příkaz! Zkus to znovu.";
        }
        document.getElementById('console').textContent = buf;
        this.value = "";
      }
    });

    // =============== RETRO HLASITOST ==================
    window.audioVolume = 1;
    document.getElementById('volume-slider').addEventListener('input', function(){
      window.audioVolume = parseFloat(this.value);
    });

    // =============== UTILITIES ========================
    function shuffle(a) {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // =============== INIT =============================
    window.onload = function(){
      showMainMenu();
    };
    </script>
</body>
</html>