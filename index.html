<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opravář PC</title>
    <style>
        /* Základní styl pro celé tělo a HTML */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            background-color: #0000AA;
            color: #FFFFFF;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            line-height: 1.5;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
            -webkit-font-smoothing: antialiased;
        }

        /* Kontejner pro celou hru */
        #game-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 950px; /* Pevná šířka */
            height: 550px; /* Pevná výška */
        }
        
        /* Styly pro různá herní menu (hlavní, obchod, úkoly, pracovní plocha) */
        #main-menu, #shop-menu, #tasks-menu, #workspace-menu, #inventory-menu {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%;
            height: 100%;
            justify-content: center;
        }

        .menu-title {
            font-size: 2.5em;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .menu-section {
            margin-bottom: 20px;
        }

        .menu-section h3 {
            font-size: 1.2em;
            margin: 0 0 10px 0;
            text-decoration: underline;
        }

        /* Styl pro jednotlivé položky v menu a tlačítka */
        .menu-item {
            cursor: pointer;
            padding: 5px 10px;
            border: 1px solid transparent;
            margin: 5px;
            transition: all 0.2s ease-in-out;
            white-space: nowrap;
        }

        .menu-item:hover {
            border-color: #FFFFFF;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .active-item {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: #FFFF00;
            font-weight: bold;
        }

        /* Nový styl pro tlačítka "Zapnout PC" a "Restartovat PC" */
        .menu-item-button {
            cursor: pointer;
            padding: 10px 20px;
            border: 1px solid transparent;
            margin: 5px;
            transition: all 0.2s ease-in-out;
            white-space: nowrap;
            background-color: rgba(255, 255, 255, 0.1);
            border-color: #FFFFFF;
        }
        
        .menu-item-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: #FFFF00;
        }
        
        /* Styly pro okno úkolu */
        #task-window {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #C0C0C0;
            border: 2px solid #000000;
            border-right: 2px solid #808080;
            border-bottom: 2px solid #808080;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.5);
            padding: 0;
            overflow: hidden;
            flex-direction: column;
            width: 854px; /* Pevná šířka */
            height: 480px; /* Pevná výška */
        }

        #task-window-header {
            background-color: #0000AA;
            color: #FFFFFF;
            padding: 5px 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }
        
        #task-window-content {
            padding: 10px;
            color: #000000;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        #task-console {
            white-space: pre-wrap;
            font-size: 14px;
            color: #000000;
            overflow-y: auto;
            flex-grow: 1;
            background-color: #FFFFFF;
            padding: 15px;
            border: 1px solid #000000;
            height: 1px; 
            padding-bottom: 40px; /* Zvýšeno spodní odsazení */
        }
        
        #task-input-line {
            position: absolute;
            bottom: 10px;
            left: 10px;
            display: flex;
            align-items: center;
            width: calc(100% - 20px);
        }

        #task-prompt {
            padding-right: 5px;
            color: #000000;
            padding-left: 5px; /* Přidáno odsazení vlevo */
        }

        #task-input-field {
            background: none;
            border: none;
            color: #000000;
            font-family: inherit;
            font-size: 14px;
            outline: none;
            caret-color: #000000;
            flex-grow: 1;
        }
        
        #task-input-field:disabled {
            background: rgba(0,0,0,0.3);
            color: #888888;
            cursor: not-allowed;
        }
        
        /* Barva pro text zadaný uživatelem */
        .console-input {
            color: #00FF00;
        }

        /* Styly pro novou startovací obrazovku */
        #startup-screen {
            display: none; /* Zpočátku skryté */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            z-index: 1000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Video uvnitř task-window */
        #intro-video {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Animace pro efekt "glitchování" */
        @keyframes glitch {
            0% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
            5% { text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 2px 2px 0 red, -2px -2px 0 cyan; transform: scale(1.01); }
            10% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); transform: scale(1); }
            15% { transform: scale(1.01) skewX(2deg); }
            20% { transform: scale(1) skewX(0); }
            100% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        }

        /* Informační panely v rozích */
        #creator-info {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: #888;
            font-size: 12px;
            text-align: right;
        }

        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #FFFFFF;
            color: #0000AA;
            padding: 15px 25px;
            border: 2px solid #FFFF00;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            font-size: 1em;
            font-weight: bold;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        /* Styly pro pracovní plochu */
        #workspace-menu {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%;
            height: 100%;
            justify-content: center;
            gap: 20px;
            position: relative;
        }
        
        /* Nový styl pro tlačítko "Zpět do menu" */
        #return-to-menu-button {
            position: absolute;
            top: 10px;
            left: 10px;
        }

        .workspace-stats {
            font-size: 1.5em;
            text-align: left;
            margin-bottom: 20px;
        }

        .shop-items-list h3 {
            margin-top: 20px;
        }
        
        /* Styly pro seznam v obchodu a inventáři */
        .shop-items-list, .inventory-items-list {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .shop-items-list .menu-item, .inventory-items-list .menu-item {
            width: 80%;
            text-align: center;
            margin: 5px 0;
        }
        
        /* Styly pro načítací pruh */
        #progress-bar {
            width: 400px;
            height: 20px;
            background-color: #000000;
            border: 2px solid #00FF00;
            padding: 2px;
            box-sizing: border-box;
            margin-top: 20px;
        }

        #progress-bar-fill {
            height: 100%;
            width: 0%;
            background-color: #00FF00;
            transition: width 0.1s linear;
        }
        
        #loading-text {
            color: #FFFFFF;
            font-size: 1.2em;
            text-align: center;
            margin-bottom: 15px;
        }

        /* Třída pro centrování obsahu */
        .center-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
            text-align: center;
        }

        /* Nové styly pro restartovací obrazovku */
        #restart-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
            text-align: center;
        }
        
        /* Třída pro texty "Zapínání...", "Restartuji...", "Vypínání..." */
        .large-text {
            font-size: 1.5em;
            text-shadow: none;
            color: #FFFFFF;
            font-weight: bold;
        }

        /* Styly pro animaci vypínání */
        #shutdown-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
            background-color: #000000;
            color: #FFFFFF;
        }

        /* Styly a animace pro točící se kolečko */
        #spinner-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
            width: 100%;
            background-color: #000000;
            color: #FFFFFF;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #FFFFFF;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>
    <audio id="background-music" loop>
        <source src="https://raw.githubusercontent.com/MinecraftPolicieCz/OPRAVARPC/103d9052c1c72bc121b028695e28d546d789aed4/%5Bno%20copyright%5D%20'In%20Dreamland%20'%20background%20music%20%5BDSWYAclv2I8%5D.mp3" type="audio/mpeg">
        Váš prohlížeč nepodporuje přehrávání zvuku.
    </audio>

    <div id="game-container">
        <div id="main-menu" style="display: none;">
            <div class="menu-title" id="game-title">OPRAVÁŘ PC 1.0</div>
            <div class="menu-section">
                <h3 id="difficulty-label-menu">Obtížnost</h3>
                <div id="difficulty-menu">
                    <span class="menu-item" data-difficulty="easy">Snadná</span>
                    <span class="menu-item" data-difficulty="medium">Střední</span>
                    <span class="menu-item" data-difficulty="hard">Těžká</span>
                </div>
            </div>
            <div class="menu-section">
                <span class="menu-item" id="load-button" style="display: none;">POKRAČOVAT</span>
                <span class="menu-item" id="start-button">NOVÁ HRA</span>
            </div>
        </div>
        
        <div id="workspace-menu" style="display: none;">
            <span class="menu-item" id="return-to-menu-button">ZPĚT DO MENU</span>
            <h2 id="workspace-title" class="menu-title">Pracovní plocha</h2>
            <div class="workspace-stats">
                <p><strong>Peněženka:</strong> <span id="money-display"></span></p>
                <p><strong>Opravených PC:</strong> <span id="repaired-pcs-display"></span></p>
            </div>
            <div class="menu-section">
                <span class="menu-item" id="tasks-button">SEZNAM ÚKOLŮ</span>
                <span class="menu-item" id="shop-button">OBCHOD</span>
                <span class="menu-item" id="inventory-button">INVENTÁŘ</span>
            </div>
        </div>

        <div id="shop-menu" style="display: none;">
            <h2 id="shop-title" class="menu-title">Obchod</h2>
            <p id="shop-description"></p>
            <div id="shop-items-list" class="shop-items-list"></div>
            <div class="menu-section">
                <span class="menu-item" id="exit-shop-button">Zpět na pracovní plochu</span>
            </div>
        </div>
        
        <div id="inventory-menu" style="display: none;">
            <h2 id="inventory-title" class="menu-title">Inventář</h2>
            <p id="inventory-description"></p>
            <div id="inventory-items-list" class="inventory-items-list"></div>
            <div class="menu-section">
                <span class="menu-item" id="exit-inventory-button">Zpět na pracovní plochu</span>
            </div>
        </div>

        <div id="tasks-menu" style="display: none;">
            <h2 id="tasks-title" class="menu-title">Seznam úkolů</h2>
            <div id="tasks-list"></div>
            <div class="menu-section">
                <span class="menu-item" id="exit-tasks-button">Zpět na pracovní plochu</span>
            </div>
        </div>
        
        <div id="task-window">
            <div id="task-window-header">
                <span id="task-window-title"></span>
            </div>
            <div id="task-window-content">
                <div id="startup-screen">
                    <button id="startup-button" class="menu-item-button">Zapnout PC</button>
                </div>
        
                <video id="intro-video" playsinline>
                    <source src="https://raw.githubusercontent.com/MinecraftPolicieCz/OPRAVARPC1.0/ab22ab6ceeb79d9f036b4da6e2e60e33beb95e4a/World_of_OSes_-_Windows_Vista_Startup_Orb.mp4" type="video/mp4">
                    Váš prohlížeč nepodporuje video tag.
                </video>
                
                <div id="loading-overlay" class="center-container" style="display: none;">
                    <div id="loading-text"></div>
                    <div id="progress-bar">
                        <div id="progress-bar-fill"></div>
                    </div>
                </div>

                <div id="restart-screen">
                    <p class="large-text">PC vyžaduje restart.</p>
                    <button id="restart-button" class="menu-item-button">Restartovat PC</button>
                </div>

                <div id="shutdown-screen" style="display: none;">
                    <div id="spinner-container">
                        <div class="spinner"></div>
                        <p class="large-text">Vypínání PC...</p>
                    </div>
                </div>
                
                <div id="task-console"></div>
                <div id="task-input-line">
                    <span id="task-prompt">C:\></span>
                    <input type="text" id="task-input-field">
                </div>
            </div>
        </div>
    </div>
    
    <div id="notification"></div>
    
    <div id="creator-info">
        Vytvořil MinecraftPolicieCz
    </div>

    <script>
        // Deklarace proměnných pro HTML prvky
        const gameContainer = document.getElementById('game-container');
        const mainMenu = document.getElementById('main-menu');
        const workspaceMenu = document.getElementById('workspace-menu');
        const shopMenu = document.getElementById('shop-menu');
        const tasksMenu = document.getElementById('tasks-menu');
        const inventoryMenu = document.getElementById('inventory-menu');
        const startButton = document.getElementById('start-button');
        const loadButton = document.getElementById('load-button');
        const difficultyMenu = document.getElementById('difficulty-menu');
        const shopTitle = document.getElementById('shop-title');
        const shopDescription = document.getElementById('shop-description');
        const shopItemsList = document.getElementById('shop-items-list');
        const exitShopButton = document.getElementById('exit-shop-button');
        const inventoryTitle = document.getElementById('inventory-title');
        const inventoryDescription = document.getElementById('inventory-description');
        const inventoryItemsList = document.getElementById('inventory-items-list');
        const exitInventoryButton = document.getElementById('exit-inventory-button');
        const tasksTitle = document.getElementById('tasks-title');
        const tasksList = document.getElementById('tasks-list');
        const exitTasksButton = document.getElementById('exit-tasks-button');
        const creatorInfoDiv = document.getElementById('creator-info');
        const tasksButton = document.getElementById('tasks-button');
        const shopButton = document.getElementById('shop-button');
        const inventoryButton = document.getElementById('inventory-button');
        const returnToMenuButton = document.getElementById('return-to-menu-button');
        const difficultyMenuLabel = document.getElementById('difficulty-label-menu');
        const notificationDiv = document.getElementById('notification');

        // Nové prvky pro okno úkolu
        const taskWindow = document.getElementById('task-window');
        const taskWindowHeader = document.getElementById('task-window-header');
        const taskWindowTitle = document.getElementById('task-window-title');
        const taskConsole = document.getElementById('task-console');
        const taskInputField = document.getElementById('task-input-field');
        const taskPromptSpan = document.getElementById('task-prompt');
        const taskWindowContent = document.getElementById('task-window-content');
        const startupScreen = document.getElementById('startup-screen');
        const startupButton = document.getElementById('startup-button');
        const introVideo = document.getElementById('intro-video');
        
        // Nové prvky pro pracovní plochu
        const moneyDisplay = document.getElementById('money-display');
        const repairedPcsDisplay = document.getElementById('repaired-pcs-display');

        // Nové prvky pro loading
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingTextDiv = document.getElementById('loading-text');
        const progressBarFill = document.getElementById('progress-bar-fill');
        
        // Nové prvky pro restart
        const restartScreen = document.getElementById('restart-screen');
        const shutdownScreen = document.getElementById('shutdown-screen');

        const backgroundMusic = document.getElementById('background-music');

        let taskIdCounter = 0;
        let currentTask = null; // Proměnná pro ukládání aktuálního úkolu
        let gameTime = new Date();
        let gameClockInterval;
        let taskGenerationInterval;
        let consoleHistory = []; // Pole pro ukládání historie konzole

        // Databáze překladů
        const translations = {
            cs: {
                gameTitle: "OPRAVÁŘ PC 1.0",
                welcome: "Vítejte v simulátoru opravy PC.\nVaše peníze: ${money}$",
                startCommand: "NOVÁ HRA",
                loadCommand: "POKRAČOVAT",
                saveCommand: "ULOŽIT HRU",
                returnToMenuCommand: "ZPĚT DO MENU",
                newJob: "Nový úkol: {name}\n----------------------------------\nPopis problému: {message}",
                shopWelcome: "Vítejte v obchodě. Nakupujte zde potřebné součástky.\nVaše peněženka: ${money}$",
                shopItem: "{item} ({price}$)",
                buyCommand: "KOUPIT",
                sellCommand: "PRODAT",
                exitShopCommand: "Zpět na pracovní plochu",
                inventoryTitle: "Inventář",
                inventoryDescription: "Zde se nachází vaše součástky, které můžete prodat.<br>Vaše peněženka: ${money}$",
                restarting: "RESTARTUJI...",
                restartDone: "Restart dokončen. Zvolte novou akci.",
                notEnoughMoney: "Nedostatek peněz nebo neplatná položka.",
                noItemToSell: "Tuto položku nemáte.",
                invalidTool: "Nemáte potřebný nástroj pro tento úkol. Zkuste si ho koupit v obchodě.",
                invalidCommand: "Neplatný příkaz. Zkuste jiný nebo použijte tlačítka.",
                jobDone: "Úkol {name} dokončen! Cena součástky: {cost}$.\nOdměna: {pay}$.\nCelkový zisk: {profit}$.\nCelkem peněz: {money}$.",
                sold: "Prodáno: {item}. Zůstatek: {money}$.",
                purchased: "Zakoupeno: {item}. Zůstatek: {money}$.",
                creatorCredit: "Vytvořil MinecraftPolicieCz",
                difficultyLabels: {
                    label: "Obtížnost",
                    easy: "Snadná",
                    medium: "Střední",
                    hard: "Těžká"
                },
                problems: {
                    "VIRUS_INFESTATION": {
                        name: "Zavirování systému",
                        message: "Systém je infikován virem! Musíte spustit antivirus.<br><b><span style='color: red;'>Zadejte: 'SCAN_VIRUS'</span></b>",
                        solution: "SCAN_VIRUS",
                        tool: "antivirus",
                        loadingTime: 10000,
                        successRate: 0.85 
                    },
                    "BAD_RAM_MODULE": {
                        name: "Chybný RAM modul",
                        message: "Počítač hlásí chybu paměti. Použijte nástroj pro diagnostiku.<br><b><span style='color: red;'>Zadejte: 'TEST_RAM'</span></b>",
                        solution: "TEST_RAM",
                        tool: "ram_tester",
                        loadingTime: 10000,
                        successRate: 1.0 
                    },
                    "NETWORK_ADAPTER_FAILURE": {
                        name: "Selhání síťového adaptéru",
                        message: "Síťový adaptér nefunguje. Zkuste ho resetovat.<br><b><span style='color: red;'>Zadejte: 'RESET_NETWORK'</span></b>",
                        solution: "RESET_NETWORK",
                        tool: "network_adapter",
                        loadingTime: 10000,
                        successRate: 1.0 
                    },
                    "SSD_FAILURE": {
                        name: "Selhání SSD disku",
                        message: "Zákazník hlásí chybu na SSD. Je potřeba ho vyměnit.<br><b><span style='color: red;'>Zadejte: 'REPLACE_SSD'</span></b>",
                        solution: "REPLACE_SSD",
                        tool: "ssd",
                        loadingTime: 10000,
                        successRate: 1.0 
                    },
                    "MOTHERBOARD_FAILURE": {
                        name: "Selhání základní desky",
                        message: "Základní deska nefunguje. Musíte ji vyměnit.<br><b><span style='color: red;'>Zadejte: 'REPLACE_MOTHERBOARD'</span></b>",
                        solution: "REPLACE_MOTHERBOARD",
                        tool: "motherboard",
                        loadingTime: 10000,
                        successRate: 1.0 
                    },
                    "THERMAL_PASTE_DRY": {
                        name: "Vyschlá teplovodivá pasta",
                        message: "PC se přehřívá, je potřeba vyměnit teplovodivou pastu.<br><b><span style='color: red;'>Zadejte: 'REPLACE_PASTE'</span></b>",
                        solution: "REPLACE_PASTE",
                        tool: "thermal_paste",
                        loadingTime: 12000,
                        successRate: 0.95
                    },
                    "FAN_BROKEN": {
                        name: "Rozbitý ventilátor",
                        message: "Ventilátor se netočí a vydává podivné zvuky.<br><b><span style='color: red;'>Zadejte: 'REPLACE_FAN'</span></b>",
                        solution: "REPLACE_FAN",
                        tool: "case_fan",
                        loadingTime: 8000,
                        successRate: 1.0
                    },
                    "CPU_OVERHEATING": {
                        name: "Přehřívání CPU",
                        message: "Procesor se přehřívá, potřebuje lepší chlazení.<br><b><span style='color: red;'>Zadejte: 'REPLACE_COOLER'</span></b>",
                        solution: "REPLACE_COOLER",
                        tool: "cpu_cooler",
                        loadingTime: 15000,
                        successRate: 0.9
                    },
                    "POWER_SUPPLY_FAIL": {
                        name: "Selhání zdroje",
                        message: "Počítač se nezapne. Zdroj je nejspíš vadný.<br><b><span style='color: red;'>Zadejte: 'REPLACE_PSU'</span></b>",
                        solution: "REPLACE_PSU",
                        tool: "psu",
                        loadingTime: 20000,
                        successRate: 1.0
                    },
                    "SOUND_CARD_BROKEN": {
                        name: "Rozbitá zvuková karta",
                        message: "Nefunguje zvuk. Zvuková karta je vadná.<br><b><span style='color: red;'>Zadejte: 'REPLACE_SOUNDCARD'</span></b>",
                        solution: "REPLACE_SOUNDCARD",
                        tool: "sound_card",
                        loadingTime: 10000,
                        successRate: 1.0
                    },
                    "BIOS_CORRUPTION": {
                        name: "Poškozený BIOS",
                        message: "BIOS je poškozený, PC se nespustí. Přehrajte nový BIOS.<br><b><span style='color: red;'>Zadejte: 'FLASH_BIOS'</span></b>",
                        solution: "FLASH_BIOS",
                        tool: "usb_stick",
                        loadingTime: 18000,
                        successRate: 0.7
                    },
                    "VGA_CABLE_FAULT": {
                        name: "Chybný VGA kabel",
                        message: "Monitor nemá signál. Vyměňte kabel.<br><b><span style='color: red;'>Zadejte: 'REPLACE_VGA'</span></b>",
                        solution: "REPLACE_VGA",
                        tool: "vga_cable",
                        loadingTime: 5000,
                        successRate: 1.0
                    },
                    "DUSTY_PC": {
                        name: "Zaprášený počítač",
                        message: "Počítač je silně zanesený prachem, čistota je na prvním místě.<br><b><span style='color: red;'>Zadejte: 'DUST_CLEAN'</span></b>",
                        solution: "DUST_CLEAN",
                        tool: "air_compressor",
                        loadingTime: 9000,
                        successRate: 1.0
                    },
                    "WEBCAM_DRIVER_ISSUE": {
                        name: "Nefunkční webkamera",
                        message: "Webkamera nefunguje, je potřeba ji vyměnit.<br><b><span style='color: red;'>Zadejte: 'REPLACE_WEBCAM'</span></b>",
                        solution: "REPLACE_WEBCAM",
                        tool: "webcam",
                        loadingTime: 10000,
                        successRate: 1.0
                    },
                    "KEYBOARD_FAILURE": {
                        name: "Nefunkční klávesnice",
                        message: "Klávesnice nereaguje. Vyměňte ji.<br><b><span style='color: red;'>Zadejte: 'REPLACE_KEYBOARD'</span></b>",
                        solution: "REPLACE_KEYBOARD",
                        tool: "keyboard",
                        loadingTime: 7000,
                        successRate: 1.0
                    }
                },
                sideTasks: {
                    "DATA_RECOVERY": {
                        name: "Obnova dat",
                        message: "Zákazník smazal důležité soubory. Obnovte je.<br><b><span style='color: red;'>Zadejte: 'RECOVER_FILES'</span></b>",
                        solution: "RECOVER_FILES",
                        pay: 15,
                        loadingTime: 10000,
                        successRate: 1.0 
                    },
                    "CLEAN_UP": {
                        name: "Vyčištění systému",
                        message: "Vyčistěte dočasné soubory, abyste urychlili systém.<br><b><span style='color: red;'>Zadejte: 'CLEAN_UP'</span></b>",
                        solution: "CLEAN_UP",
                        pay: 10,
                        successRate: 0.85,
                        loadingTime: 10000 
                    },
                    "SYSTEM_UPDATE": {
                        name: "Aktualizace systému",
                        message: "Systém potřebuje aktualizovat.<br><b><span style='color: red;'>Zadejte: 'SYSTEM_UPDATE'</span></b>",
                        solution: "SYSTEM_UPDATE",
                        pay: 20,
                        successRate: 1.0,
                        loadingTime: 10000
                    },
                    "DRIVERS_INSTALL": {
                        name: "Instalace ovladačů",
                        message: "Nainstalujte chybějící ovladače pro správnou funkci.<br><b><span style='color: red;'>Zadejte: 'DRIVERS_INSTALL'</span></b>",
                        solution: "DRIVERS_INSTALL",
                        pay: 25,
                        successRate: 1.0,
                        loadingTime: 10000
                    },
                    "HARD_DRIVE_DEFRAG": {
                        name: "Defragmentace disku",
                        message: "Defragmentujte pevný disk pro zvýšení rychlosti.<br><b><span style='color: red;'>Zadejte: 'DEFRAG_HDD'</span></b>",
                        solution: "DEFRAG_HDD",
                        pay: 15,
                        successRate: 1.0,
                        loadingTime: 10000
                    },
                    "REGISTRY_CLEAN": {
                        name: "Čištění registrů",
                        message: "Vyčistěte registr pro zlepšení výkonu.<br><b><span style='color: red;'>Zadejte: 'CLEAN_REG'</span></b>",
                        solution: "CLEAN_REG",
                        pay: 12,
                        loadingTime: 9000,
                        successRate: 0.95
                    },
                    "STARTUP_OPTIMIZATION": {
                        name: "Optimalizace spouštění",
                        message: "Počítač se spouští příliš pomalu. Optimalizujte spouštěcí programy.<br><b><span style='color: red;'>Zadejte: 'OPTIMIZE_STARTUP'</span></b>",
                        solution: "OPTIMIZE_STARTUP",
                        pay: 18,
                        loadingTime: 10000,
                        successRate: 1.0
                    },
                    "FULL_DIAGNOSTICS": {
                        name: "Kompletní diagnostika",
                        message: "Proveďte kompletní diagnostiku systému.<br><b><span style='color: red;'>Zadejte: 'RUN_DIAG'</span></b>",
                        solution: "RUN_DIAG",
                        pay: 22,
                        loadingTime: 15000,
                        successRate: 1.0
                    },
                    "DISK_HEALTH_CHECK": {
                        name: "Kontrola stavu disku",
                        message: "Zkontrolujte stav pevného disku.<br><b><span style='color: red;'>Zadejte: 'CHECK_DISK'</span></b>",
                        solution: "CHECK_DISK",
                        pay: 14,
                        loadingTime: 8000,
                        successRate: 1.0
                    },
                    "PERMISSIONS_REPAIR": {
                        name: "Oprava oprávnění",
                        message: "Opravte poškozená oprávnění souborů.<br><b><span style='color: red;'>Zadejte: 'REPAIR_PERMS'</span></b>",
                        solution: "REPAIR_PERMS",
                        pay: 17,
                        loadingTime: 11000,
                        successRate: 0.9
                    },
                    "FIREWALL_ENABLE": {
                        name: "Zapnutí firewallu",
                        message: "Povolte firewall pro zvýšení bezpečnosti.<br><b><span style='color: red;'>Zadejte: 'ENABLE_FW'</span></b>",
                        solution: "ENABLE_FW",
                        pay: 13,
                        loadingTime: 6000,
                        successRate: 1.0
                    },
                    "GRAPHICS_UPDATE": {
                        name: "Aktualizace grafiky",
                        message: "Aktualizujte grafické ovladače.<br><b><span style='color: red;'>Zadejte: 'UPDATE_GRAPHICS'</span></b>",
                        solution: "UPDATE_GRAPHICS",
                        pay: 19,
                        loadingTime: 10000,
                        successRate: 1.0
                    },
                    "SYSTEM_FILES_REPAIR": {
                        name: "Oprava systémových souborů",
                        message: "Opravte poškozené systémové soubory.<br><b><span style='color: red;'>Zadejte: 'REPAIR_SFC'</span></b>",
                        solution: "REPAIR_SFC",
                        pay: 28,
                        loadingTime: 18000,
                        successRate: 0.8
                    },
                    "WINSOCK_RESET": {
                        name: "Reset síťového protokolu",
                        message: "Resetujte nastavení síťového protokolu Winsock.<br><b><span style='color: red;'>Zadejte: 'RESET_WINSOCK'</span></b>",
                        solution: "RESET_WINSOCK",
                        pay: 16,
                        loadingTime: 7000,
                        successRate: 1.0
                    },
                    "CREATE_RESTORE_POINT": {
                        name: "Vytvoření bodu obnovy",
                        message: "Vytvořte bod obnovení systému.<br><b><span style='color: red;'>Zadejte: 'CREATE_RP'</span></b>",
                        solution: "CREATE_RP",
                        pay: 20,
                        loadingTime: 12000,
                        successRate: 1.0
                    }
                },
                shopItems: {
                    'antivirus': 'antivirus',
                    'ram_tester': 'diagnostika RAM',
                    'network_adapter': 'síťový adaptér',
                    'cpu': 'procesor',
                    'gpu': 'grafická karta',
                    'ram': 'RAM',
                    'ssd': 'SSD',
                    'motherboard': 'základní deska',
                    'software_pack': 'balík software',
                    'thermal_paste': 'teplovodivá pasta',
                    'case_fan': 'ventilátor skříně',
                    'cpu_cooler': 'chladič CPU',
                    'psu': 'zdroj (PSU)',
                    'sound_card': 'zvuková karta',
                    'usb_stick': 'USB disk',
                    'vga_cable': 'VGA kabel',
                    'air_compressor': 'vzduchový kompresor',
                    'webcam': 'webkamera',
                    'keyboard': 'klávesnice'
                },
                repairMode: "OPRAVNÝ REŽIM: Zadejte příkaz do konzole.",
                taskInfo: "{name} (Odměna: {pay}$)",
                noTasks: "Momentálně nejsou k dispozici žádné úkoly.",
                tasksHeader: "Seznam úkolů",
                newTasksAvailable: "Přibyly nové úkoly! Klikněte na 'SEZNAM ÚKOLŮ', abyste si je prohlédli.",
                selectTaskCommand: "SELECT_TASK",
                tasksCommand: "SEZNAM ÚKOLŮ",
                shopCommand: "OBCHOD",
                inventoryCommand: "INVENTÁŘ",
                gameSaved: "Hra uložena.",
                gameLoaded: "Hra načtena. Vítejte zpět!",
                noSavedGame: "Žádná uložená hra nebyla nalezena.",
                confirmNewGame: "Opravdu chcete začít novou hru? Stávající uložená hra bude přepsána.",
                loading: "Načítám...",
                success: "Úkol úspěšně dokončen!",
                failure: "Úkol selhal. Prosím, zkuste to znovu.",
                taskSelected: "Úkol '{name}' byl vybrán. Zadejte správný příkaz pro jeho splnění, nebo vyberte jiný.",
                notEnoughTool: "Pro tento úkol nemáte potřebnou součástku: {tool}. Kupte si ji v obchodě a zkuste to znovu.",
                shutdown: "SHUTDOWN",
                startup: "ZAPÍNÁM PC...",
                welcomeScreen: "Vítejte!",
                enterCommand: "Zadejte příkaz:",
                commandsList: "Dostupné příkazy: tasks, shop, save, shutdown",
                sellTitle: "Prodat položky",
                sellInfo: "{item} ({sellPrice}$)",
                finalMessagePrompt: "Pro vypnutí PC napište SHUTDOWN",
                taskCompletedMessage: "Úkol dokončen! PC je třeba restartovat."
            }
        };

        const prices = {
            antivirus: 50,
            ram_tester: 75,
            network_adapter: 25,
            cpu: 200,
            gpu: 300,
            ram: 100,
            ssd: 150,
            motherboard: 250,
            software_pack: 60,
            thermal_paste: 10,
            case_fan: 30,
            cpu_cooler: 80,
            psu: 120,
            sound_card: 50,
            usb_stick: 15,
            vga_cable: 5,
            air_compressor: 40,
            webcam: 35,
            keyboard: 60
        };

        let gameState = {
            money: 100,
            inventory: {},
            tasks: [],
            difficulty: 'medium',
            language: 'cs',
            repairedPcs: 0,
        };
        
        const difficulties = {
            easy: {
                task_probability: 0.8,
                pay_multiplier: 1.2
            },
            medium: {
                task_probability: 0.5,
                pay_multiplier: 1.0
            },
            hard: {
                task_probability: 0.2,
                pay_multiplier: 0.8
            }
        };

        function getTranslation(key, placeholders = {}) {
            let translation = translations.cs[key] || key;
            for (const placeholder in placeholders) {
                translation = translation.replace(`{${placeholder}}`, placeholders[placeholder]);
            }
            return translation;
        }
        
        // Funkce pro zobrazení zprávy
        function showNotification(message) {
            notificationDiv.textContent = message;
            notificationDiv.style.display = 'block';
            notificationDiv.style.opacity = 1;
            setTimeout(() => {
                notificationDiv.style.opacity = 0;
                setTimeout(() => {
                    notificationDiv.style.display = 'none';
                }, 500);
            }, 3000);
        }

        // Nová funkce pro vykreslení obsahu konzole
        function renderConsole() {
            taskConsole.innerHTML = consoleHistory.join('<br>');
            taskConsole.scrollTop = taskConsole.scrollHeight;
        }

        // Funkce pro přidání textu do konzole a vykreslení
        function appendToConsole(text) {
            consoleHistory.push(text);
            renderConsole();
        }

        // Funkce pro reset herní obrazovky
        function resetGameScreen() {
            mainMenu.style.display = 'none';
            workspaceMenu.style.display = 'none';
            shopMenu.style.display = 'none';
            tasksMenu.style.display = 'none';
            inventoryMenu.style.display = 'none';
            taskWindow.style.display = 'none';
            document.body.style.backgroundColor = '#0000AA';
        }

        // Funkce pro zobrazení/skrytí menu
        function showMenu(menuName) {
            resetGameScreen();
            
            switch(menuName) {
                case 'main':
                    mainMenu.style.display = 'flex';
                    break;
                case 'workspace':
                    workspaceMenu.style.display = 'flex';
                    updateWorkspaceMenu();
                    break;
                case 'shop':
                    shopMenu.style.display = 'flex';
                    updateShopMenu();
                    break;
                case 'tasks':
                    tasksMenu.style.display = 'flex';
                    updateTasksMenu();
                    break;
                case 'inventory':
                    inventoryMenu.style.display = 'flex';
                    updateInventoryMenu();
                    break;
                case 'task':
                    taskWindow.style.display = 'flex';
                    break;
            }
        }

        // Funkce pro zobrazení hlavního menu
        function returnToMainMenu() {
            showMenu('main');
            stopMusic();
            clearInterval(gameClockInterval);
            clearInterval(taskGenerationInterval);
            gameClockInterval = null;
            taskGenerationInterval = null;
        }
        
        // Funkce pro generování nových úkolů
        function generateNewTasks() {
            const problems = getTranslation('problems');
            const sideTasks = getTranslation('sideTasks');
            const allTasksKeys = [...Object.keys(problems), ...Object.keys(sideTasks)];
            
            // Náhodně vybereme jeden typ úkolu
            const randomTaskKey = allTasksKeys[Math.floor(Math.random() * allTasksKeys.length)];
            
            let newTask;
            if (problems[randomTaskKey]) {
                const problem = problems[randomTaskKey];
                newTask = {
                    id: taskIdCounter++,
                    type: 'main',
                    name: problem.name,
                    message: problem.message,
                    solution: problem.solution,
                    tool: problem.tool,
                    loadingTime: problem.loadingTime,
                    successRate: problem.successRate,
                    pay: prices[problem.tool] * (Math.random() * 0.5 + 1.5) * difficulties[gameState.difficulty].pay_multiplier,
                    componentCost: prices[problem.tool]
                };
            } else {
                const sideTask = sideTasks[randomTaskKey];
                newTask = {
                    id: taskIdCounter++,
                    type: 'side',
                    name: sideTask.name,
                    message: sideTask.message,
                    solution: sideTask.solution,
                    pay: sideTask.pay * difficulties[gameState.difficulty].pay_multiplier,
                    loadingTime: sideTask.loadingTime,
                    successRate: sideTask.successRate,
                    componentCost: 0
                };
            }
            gameState.tasks.push(newTask);
            showNotification(getTranslation('newTasksAvailable'));
        saveGame(false); // AUTOSAVE
        }

        // Funkce, která připraví okno úkolu pro zobrazení
        function prepareTaskWindow() {
            taskWindowHeader.style.display = 'flex';
            taskConsole.style.display = 'block';
            taskInputField.style.display = 'block';
            taskPromptSpan.style.display = 'block';
            startupScreen.style.display = 'none';
            introVideo.style.display = 'none';
            loadingOverlay.style.display = 'none';
            restartScreen.style.display = 'none';
            shutdownScreen.style.display = 'none';

            // Zajištění správného stylingu
            taskWindowContent.classList.remove('center-container');
            taskWindow.style.backgroundColor = '#C0C0C0';
            taskWindow.style.color = '#000000';
            taskInputField.disabled = false;
        }

        // Nová funkce pro spouštění sekvence PC
        function startTaskSequence(task) {
            resetGameScreen();
            taskWindow.style.display = 'flex';
            
            // Důkladně skryjeme všechny části okna úkolu před zobrazením úvodní obrazovky
            taskWindowHeader.style.display = 'none';
            taskConsole.style.display = 'none';
            taskInputField.style.display = 'none';
            taskPromptSpan.style.display = 'none';
            introVideo.style.display = 'none';
            loadingOverlay.style.display = 'none';
            restartScreen.style.display = 'none';
            shutdownScreen.style.display = 'none';
            startupScreen.style.display = 'flex';
            
            currentTask = task;

            // Odebereme staré event listenery, aby se neopakovaly
            startupButton.removeEventListener('click', handleStartupButtonClick);
            introVideo.removeEventListener('ended', handleVideoEnded);

            // Nastavíme nové listenery
            startupButton.addEventListener('click', handleStartupButtonClick);
            introVideo.addEventListener('ended', handleVideoEnded);
        }

        // Event handler pro tlačítko "Zapnout PC"
        function handleStartupButtonClick() {
            startupScreen.style.display = 'none';
            introVideo.style.display = 'block';
            introVideo.play();
        }

        // Event handler pro konec videa
        function handleVideoEnded() {
            prepareTaskWindow();
            taskWindowTitle.textContent = `Oprava: ${currentTask.name}`;
            consoleHistory = []; // Reset historie konzole
            appendToConsole(`<span style="color: red;">` + getTranslation('repairMode') + `</span>`);
            appendToConsole(getTranslation('newJob', { name: currentTask.name, message: currentTask.message }));
            taskInputField.value = '';
            taskInputField.focus();
            taskInputField.onkeydown = (event) => {
                if (event.key === 'Enter') {
                    handleTaskInput(taskInputField.value);
                    taskInputField.value = '';
                }
            };
        }

        // Funkce pro zahájení úkolu v okně
        function startTask(task) {
            if (task.tool && (!gameState.inventory[task.tool] || gameState.inventory[task.tool] <= 0)) {
                showMenu('workspace');
                showNotification(getTranslation('notEnoughTool', { tool: getTranslation('shopItems')[task.tool] }));
                return;
            }
            
            startTaskSequence(task);
        }

        // Funkce pro zpracování příkazu v okně úkolu
        function handleTaskInput(input) {
            const command = input.toUpperCase().trim();
            
            appendToConsole(`<span class="console-input">C:\\> ${command}</span>`);

            if (command === 'SHUTDOWN') {
                showShutdownScreen();
                return;
            }
            
            if (!currentTask) {
                appendToConsole(getTranslation('invalidCommand'));
                return;
            }
            
            if (command === currentTask.solution) {
                showLoadingOverlay(currentTask.loadingTime, currentTask.successRate, () => {
                    completeTask();
                }, () => {
                    failTask();
                });
            } else {
                appendToConsole(getTranslation('invalidCommand'));
            }
        }
        
        function showRestartScreen() {
            taskWindowHeader.style.display = 'none';
            taskConsole.style.display = 'none';
            taskInputField.style.display = 'none';
            taskPromptSpan.style.display = 'none';
            loadingOverlay.style.display = 'none';
            
            // Restore the HTML of the restart screen to its original state
            restartScreen.innerHTML = `
                <p class="large-text">PC vyžaduje restart.</p>
                <button id="restart-button" class="menu-item-button">Restartovat PC</button>
            `;
            // Find the newly created button and attach the event listener
            document.getElementById('restart-button').addEventListener('click', handleRestartClick);

            taskWindowContent.classList.add('center-container');
            taskWindow.style.backgroundColor = '#000000';
            taskWindow.style.color = '#FFFFFF';
            restartScreen.style.display = 'flex';
        }

        function handleRestartClick() {
            restartScreen.innerHTML = `
                <div id="spinner-container" class="center-container">
                    <div class="spinner"></div>
                    <p class="large-text">Restartuji PC...</p>
                </div>
            `;
            setTimeout(() => {
                const task = currentTask;
                const message = getTranslation('jobDone', {
                    name: task.name,
                    cost: Math.round(task.componentCost),
                    pay: Math.round(task.pay),
                    profit: Math.round(task.pay - task.componentCost),
                    money: Math.round(gameState.money),
                });
                restartScreen.innerHTML = '';
                introVideo.style.display = 'block';
                introVideo.currentTime = 0;
                // Odstranit starý listener, přidat nový
                introVideo.onended = null;
                introVideo.removeEventListener('ended', handleVideoEnded);
                introVideo.addEventListener('ended', function onRestartVideoEnd() {
                    introVideo.removeEventListener('ended', onRestartVideoEnd);
                    showFinalMessageConsole(message);
                });
                introVideo.play();
            }, 5000);
        }
        
        function showShutdownScreen() {
            taskWindowHeader.style.display = 'none';
            taskConsole.style.display = 'none';
            taskInputField.style.display = 'none';
            taskPromptSpan.style.display = 'none';
            loadingOverlay.style.display = 'none';
            restartScreen.style.display = 'none';
            
            taskWindowContent.classList.add('center-container');
            taskWindow.style.backgroundColor = '#000000';
            taskWindow.style.color = '#FFFFFF';
            shutdownScreen.style.display = 'flex';

            setTimeout(() => {
                showMenu('workspace');
            }, 3000);
        }

        // Funkce pro zobrazení zprávy po dokončení úkolu ve stylu konzole
        function showFinalMessageConsole(message) {
            prepareTaskWindow();
            consoleHistory = [];
            appendToConsole(`<span style="color: green;">${message}</span>`);
            appendToConsole(getTranslation('finalMessagePrompt'));
            taskInputField.value = '';
            taskInputField.focus();
            taskInputField.onkeydown = (event) => {
                if (event.key === 'Enter') {
                    const command = taskInputField.value.toUpperCase().trim();
                    if (command === 'SHUTDOWN') {
                        currentTask = null;
                        showShutdownScreen();
                    } else {
                        appendToConsole(`<span class="console-input">C:\\> ${command}</span>`);
                        appendToConsole(getTranslation('invalidCommand'));
                        taskInputField.value = '';
                    }
                }
            };
        }

        function completeTask() {
            const task = currentTask;
            
            if (task.tool) {
                if (gameState.inventory[task.tool] && gameState.inventory[task.tool] > 0) {
                    gameState.inventory[task.tool]--;
                } else {
                    failTask();
                    return;
                }
            }
            
            gameState.money += task.pay; 
            gameState.repairedPcs++;
            
            // Odstranění dokončeného úkolu
            gameState.tasks = gameState.tasks.filter(t => t.id !== task.id);
            
        saveGame(false); // AUTOSAVE
            showRestartScreen();
        }

        function failTask() {
            currentTask = null;
            showFinalMessageConsole(getTranslation('failure'));
        }

        // Funkce pro aktualizaci menu pracovní plochy
        function updateWorkspaceMenu() {
            moneyDisplay.textContent = `${Math.round(gameState.money)}$`;
            repairedPcsDisplay.textContent = gameState.repairedPcs;
        }

        // Funkce pro aktualizaci menu úkolů
        function updateTasksMenu() {
            tasksList.innerHTML = '';

            if (gameState.tasks.length > 0) {
                gameState.tasks.forEach(task => {
                    const div = document.createElement('div');
                    div.classList.add('menu-item');
                    div.textContent = getTranslation('taskInfo', { name: task.name, pay: Math.round(task.pay) });
                    div.onclick = () => startTask(task);
                    tasksList.appendChild(div);
                });
            } else {
                const div = document.createElement('div');
                div.textContent = getTranslation('noTasks');
                tasksList.appendChild(div);
            }
        }
        
        function updateShopMenu() {
            shopItemsList.innerHTML = '';
            shopDescription.innerHTML = getTranslation('shopWelcome', { money: Math.round(gameState.money) });
            
            const shopItems = getTranslation('shopItems');
            
            for (const itemKey in prices) {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('menu-item');
                itemDiv.textContent = `${shopItems[itemKey]} (${prices[itemKey]}$)`;
                itemDiv.onclick = () => buyItem(itemKey);
                shopItemsList.appendChild(itemDiv);
            }
        }
        
        function updateInventoryMenu() {
            inventoryItemsList.innerHTML = '';
            inventoryDescription.innerHTML = getTranslation('inventoryDescription', { money: Math.round(gameState.money) });
            
            let hasSellableItems = false;
            for (const itemKey in gameState.inventory) {
                if (gameState.inventory[itemKey] > 0) {
                    hasSellableItems = true;
                    const sellPrice = prices[itemKey] / 2;
                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('menu-item');
                    itemDiv.textContent = `${getTranslation('shopItems')[itemKey]} (${sellPrice}$ x${gameState.inventory[itemKey]})`;
                    itemDiv.onclick = () => sellItem(itemKey);
                    inventoryItemsList.appendChild(itemDiv);
                }
            }
            
            if (!hasSellableItems) {
                const noItemsDiv = document.createElement('div');
                noItemsDiv.textContent = getTranslation('noItemToSell');
                inventoryItemsList.appendChild(noItemsDiv);
            }
        }
        
        function buyItem(item) {
            const price = prices[item];
            if (gameState.money >= price) {
                gameState.money -= price;
                if (!gameState.inventory[item]) {
                    gameState.inventory[item] = 0;
                }
                gameState.inventory[item]++;
                showNotification(getTranslation('purchased', { item: getTranslation('shopItems')[item], money: Math.round(gameState.money) }));
                updateShopMenu();
            saveGame(false); // AUTOSAVE
            } else {
                showNotification(getTranslation('notEnoughMoney'));
            }
        }

        function sellItem(item) {
            if (gameState.inventory[item] && gameState.inventory[item] > 0) {
                const sellPrice = prices[item] / 2;
                gameState.money += sellPrice;
                gameState.inventory[item]--;
                showNotification(getTranslation('sold', { item: getTranslation('shopItems')[item], money: Math.round(gameState.money) }));
                updateInventoryMenu();
                saveGame(false); // AUTOSAVE
            } else {
                showNotification(getTranslation('noItemToSell'));
            }
        }


        function showLoadingOverlay(duration, successRate, onComplete, onFail) {
            // Skryjeme prvky konzole a zobrazíme loading screen
            taskWindowHeader.style.display = 'none';
            taskConsole.style.display = 'none';
            taskInputField.style.display = 'none';
            taskPromptSpan.style.display = 'none';
            
            // Zobrazíme loading overlay
            loadingOverlay.style.display = 'flex';
            
            // Zajištění správného stylingu
            taskWindow.style.backgroundColor = '#000000';
            taskWindow.style.color = '#FFFFFF';
            loadingTextDiv.textContent = getTranslation('loading');
            
            progressBarFill.style.width = '0%';

            let progress = 0;
            const interval = 50;
            const step = (100 / (duration / interval));
            
            const loadingInterval = setInterval(() => {
                progress += step;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(loadingInterval);
                    setTimeout(() => {
                        // Po dokončení načítání se vrátíme k původnímu zobrazení
                        prepareTaskWindow();
                        if (Math.random() < successRate) {
                            onComplete();
                        } else {
                            onFail();
                        }
                    }, 500);
                }
                progressBarFill.style.width = `${progress}%`;
            }, interval);
        }
        
        function setDifficulty(difficulty) {
            gameState.difficulty = difficulty;
            updateMenu();
            showNotification(`Obtížnost nastavena na: ${getTranslation('difficultyLabels')[difficulty]}`);
        }
        
        function updateMenu() {
            difficultyMenu.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active-item');
                if (item.dataset.difficulty === gameState.difficulty) {
                    item.classList.add('active-item');
                }
            });
            difficultyMenuLabel.textContent = getTranslation('difficultyLabels').label;
            startButton.textContent = getTranslation('startCommand');
            loadButton.textContent = getTranslation('loadCommand');
            tasksButton.textContent = getTranslation('tasksCommand');
            shopButton.textContent = getTranslation('shopCommand');
            inventoryButton.textContent = getTranslation('inventoryCommand');
            returnToMenuButton.textContent = getTranslation('returnToMenuCommand');
            creatorInfoDiv.textContent = getTranslation('creatorCredit');
            shopTitle.textContent = getTranslation('shopCommand');
            inventoryTitle.textContent = getTranslation('inventoryTitle');
            tasksTitle.textContent = getTranslation('tasksHeader');
            exitShopButton.textContent = getTranslation('exitShopCommand');
            exitInventoryButton.textContent = getTranslation('exitShopCommand');
            exitTasksButton.textContent = getTranslation('exitShopCommand');
            document.title = getTranslation('gameTitle');
        }

        function saveGame(showNotif = true) {
            localStorage.setItem('opravarec_pc_save', JSON.stringify(gameState));
            if (showNotif) {
                showNotification(getTranslation('gameSaved'));
            }
        }

        function loadGame() {
            const savedState = localStorage.getItem('opravarec_pc_save');
            if (savedState) {
                gameState = JSON.parse(savedState);
                startGameClockAndTasks(); // Spustíme generování úkolů
                showMenu('workspace');
                showNotification(getTranslation('gameLoaded'));
                playMusic();
            } else {
                showNotification(getTranslation('noSavedGame'));
            }
        }

        function checkSavedGame() {
            if (localStorage.getItem('opravarec_pc_save')) {
                loadButton.style.display = 'inline-block';
            } else {
                loadButton.style.display = 'none';
            }
        }
        
        function playMusic() {
            backgroundMusic.play().catch(e => console.error("Problém s přehráváním hudby:", e));
        }

        function stopMusic() {
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;
        }

        // Funkce pro spuštění časovače generování úkolů
        function startGameClockAndTasks() {
            if (taskGenerationInterval) {
                clearInterval(taskGenerationInterval);
            }
            // Spustí se pravidelné generování úkolů s náhodným intervalem mezi 10 a 30 vteřinami
            taskGenerationInterval = setInterval(() => {
                // Generujeme úkoly, pouze pokud jich je méně než 5
                if (gameState.tasks.length < 5) {
                    generateNewTasks();
                }
            }, Math.random() * (30000 - 10000) + 10000);
        }

        function startGame() {
            gameState = {
                money: 100,
                inventory: {},
                tasks: [],
                difficulty: gameState.difficulty,
                language: 'cs',
                repairedPcs: 0,
            };
            // Vygeneruje se první úkol ihned po startu
            generateNewTasks();
            
            startGameClockAndTasks(); // Spustíme generování úkolů

            showMenu('workspace');
            playMusic();
        }

        // Event listenery pro tlačítka v menu a v průběhu hry
        difficultyMenu.addEventListener('click', (event) => {
            if (event.target.classList.contains('menu-item')) {
                setDifficulty(event.target.dataset.difficulty);
            }
        });

        // Po změně pořadí tlačítek v HTML je potřeba znovu navázat eventy
        document.getElementById('start-button').addEventListener('click', () => {
            if (localStorage.getItem('opravarec_pc_save')) {
                if (confirm(getTranslation('confirmNewGame'))) {
                    startGame();
                }
            } else {
                startGame();
            }
        });
        document.getElementById('load-button').addEventListener('click', loadGame);
        tasksButton.addEventListener('click', () => showMenu('tasks'));
        shopButton.addEventListener('click', () => showMenu('shop'));
        inventoryButton.addEventListener('click', () => showMenu('inventory'));
        returnToMenuButton.addEventListener('click', returnToMainMenu);
        exitShopButton.addEventListener('click', () => showMenu('workspace'));
        exitInventoryButton.addEventListener('click', () => showMenu('workspace'));
        exitTasksButton.addEventListener('click', () => showMenu('workspace'));
        
        // Inicializace
        resetGameScreen();
        updateMenu();
        checkSavedGame();
        showMenu('main');
    </script>
</body>
</html>
